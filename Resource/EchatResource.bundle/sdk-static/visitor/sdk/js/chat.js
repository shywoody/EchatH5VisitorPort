!function(e,t,i){function o(i,o){this.wrapper="string"==typeof i?t.querySelector(i):i,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,disablePointer:!r.hasPointer,disableTouch:r.hasPointer||!r.hasTouch,disableMouse:r.hasPointer||r.hasTouch,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0,bindToWrapper:void 0===e.onmousedown};for(var s in o)this.options[s]=o[s];this.translateZ=this.options.HWCompositing&&r.hasPerspective?" translateZ(0)":"",this.options.useTransition=r.hasTransition&&this.options.useTransition,this.options.useTransform=r.hasTransform&&this.options.useTransform,this.options.eventPassthrough=!0===this.options.eventPassthrough?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"!=this.options.eventPassthrough&&this.options.scrollY,this.options.scrollX="horizontal"!=this.options.eventPassthrough&&this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?r.ease[this.options.bounceEasing]||r.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,!0===this.options.tap&&(this.options.tap="tap"),this.options.useTransition||this.options.useTransform||/relative|absolute/i.test(this.scrollerStyle.position)||(this.scrollerStyle.position="relative"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,3==this.options.probeType&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function s(e,i,o){var s=t.createElement("div"),n=t.createElement("div");return!0===o&&(s.style.cssText="position:absolute;z-index:9999",n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),n.className="iScrollIndicator","h"==e?(!0===o&&(s.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",n.style.height="100%"),s.className="iScrollHorizontalScrollbar"):(!0===o&&(s.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",n.style.width="100%"),s.className="iScrollVerticalScrollbar"),s.style.cssText+=";overflow:hidden",i||(s.style.pointerEvents="none"),s.appendChild(n),s}function n(i,o){this.wrapper="string"==typeof o.el?t.querySelector(o.el):o.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=i,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var s in o)this.options[s]=o[s];if(this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(r.addEvent(this.indicator,"touchstart",this),r.addEvent(e,"touchend",this)),this.options.disablePointer||(r.addEvent(this.indicator,r.prefixPointerEvent("pointerdown"),this),r.addEvent(e,r.prefixPointerEvent("pointerup"),this)),this.options.disableMouse||(r.addEvent(this.indicator,"mousedown",this),r.addEvent(e,"mouseup",this))),this.options.fade){this.wrapperStyle[r.style.transform]=this.scroller.translateZ;var n=r.style.transitionDuration;if(!n)return;this.wrapperStyle[n]=r.isBadAndroid?"0.0001ms":"0ms";var l=this;r.isBadAndroid&&a(function(){"0.0001ms"===l.wrapperStyle[n]&&(l.wrapperStyle[n]="0s")}),this.wrapperStyle.opacity="0"}}var a=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},r=function(){function o(e){return!1!==a&&(""===a?e:a+e.charAt(0).toUpperCase()+e.substr(1))}var s={},n=t.createElement("div").style,a=function(){for(var e=["t","webkitT","MozT","msT","OT"],t=0,i=e.length;t<i;t++)if(e[t]+"ransform"in n)return e[t].substr(0,e[t].length-1);return!1}();s.getTime=Date.now||function(){return(new Date).getTime()},s.extend=function(e,t){for(var i in t)e[i]=t[i]},s.addEvent=function(e,t,i,o){e.addEventListener(t,i,!!o)},s.removeEvent=function(e,t,i,o){e.removeEventListener(t,i,!!o)},s.prefixPointerEvent=function(t){return e.MSPointerEvent?"MSPointer"+t.charAt(7).toUpperCase()+t.substr(8):t},s.momentum=function(e,t,o,s,n,a){var r,l,c=e-t,h=i.abs(c)/o;return a=void 0===a?6e-4:a,r=e+h*h/(2*a)*(c<0?-1:1),l=h/a,r<s?(r=n?s-n/2.5*(h/8):s,c=i.abs(r-e),l=c/h):r>0&&(r=n?n/2.5*(h/8):0,c=i.abs(e)+r,l=c/h),{destination:i.round(r),duration:l}};var r=o("transform");return s.extend(s,{hasTransform:!1!==r,hasPerspective:o("perspective")in n,hasTouch:"ontouchstart"in e,hasPointer:!(!e.PointerEvent&&!e.MSPointerEvent),hasTransition:o("transition")in n}),s.isBadAndroid=function(){var t=e.navigator.appVersion;if(/Android/.test(t)&&!/Chrome\/\d/.test(t)){var i=t.match(/Safari\/(\d+.\d)/);return!(i&&"object"==typeof i&&i.length>=2)||parseFloat(i[1])<535.19}return!1}(),s.extend(s.style={},{transform:r,transitionTimingFunction:o("transitionTimingFunction"),transitionDuration:o("transitionDuration"),transitionDelay:o("transitionDelay"),transformOrigin:o("transformOrigin"),touchAction:o("touchAction")}),s.hasClass=function(e,t){return new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},s.addClass=function(e,t){if(!s.hasClass(e,t)){var i=e.className.split(" ");i.push(t),e.className=i.join(" ")}},s.removeClass=function(e,t){if(s.hasClass(e,t)){var i=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(i," ")}},s.offset=function(e){for(var t=-e.offsetLeft,i=-e.offsetTop;e=e.offsetParent;)t-=e.offsetLeft,i-=e.offsetTop;return{left:t,top:i}},s.preventDefaultException=function(e,t){for(var i in t)if(t[i].test(e[i]))return!0;return!1},s.extend(s.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),s.extend(s.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(e){return e*(2-e)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(e){return i.sqrt(1- --e*e)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(e){return(e-=1)*e*(5*e+4)+1}},bounce:{style:"",fn:function(e){return(e/=1)<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}},elastic:{style:"",fn:function(e){return 0===e?0:1==e?1:.4*i.pow(2,-10*e)*i.sin((e-.055)*(2*i.PI)/.22)+1}}}),s.tap=function(e,i){var o=t.createEvent("Event");o.initEvent(i,!0,!0),o.pageX=e.pageX,o.pageY=e.pageY,e.target.dispatchEvent(o)},s.click=function(i){var o,s=i.target;/(SELECT|INPUT|TEXTAREA)/i.test(s.tagName)||((o=t.createEvent(e.MouseEvent?"MouseEvents":"Event")).initEvent("click",!0,!0),o.view=i.view||e,o.detail=1,o.screenX=s.screenX||0,o.screenY=s.screenY||0,o.clientX=s.clientX||0,o.clientY=s.clientY||0,o.ctrlKey=!!i.ctrlKey,o.altKey=!!i.altKey,o.shiftKey=!!i.shiftKey,o.metaKey=!!i.metaKey,o.button=0,o.relatedTarget=null,o._constructed=!0,s.dispatchEvent(o))},s.getTouchAction=function(e,t){var i="none";return"vertical"===e?i="pan-y":"horizontal"===e&&(i="pan-x"),t&&"none"!=i&&(i+=" pinch-zoom"),i},s.getRect=function(e){if(e instanceof SVGElement){var t=e.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}}return{top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}},s}();o.prototype={version:"5.2.0-snapshot",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),clearTimeout(this.resizeTimeout),this.resizeTimeout=null,this._execEvent("destroy")},_transitionEnd:function(e){e.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(e){if(1!=r.eventType[e.type]){if(0!==(e.which?e.button:e.button<2?0:4==e.button?1:2))return}if(this.enabled&&(!this.initiated||r.eventType[e.type]===this.initiated)){!this.options.preventDefault||r.isBadAndroid||r.preventDefaultException(e.target,this.options.preventDefaultException)||e.preventDefault();var t,o=e.touches?e.touches[0]:e;this.initiated=r.eventType[e.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this.startTime=r.getTime(),this.options.useTransition&&this.isInTransition?(this._transitionTime(),this.isInTransition=!1,t=this.getComputedPosition(),this._translate(i.round(t.x),i.round(t.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=o.pageX,this.pointY=o.pageY,this._execEvent("beforeScrollStart")}},_move:function(e){if(this.enabled&&r.eventType[e.type]===this.initiated){this.options.preventDefault&&e.preventDefault();var t,o,s,n,a=e.touches?e.touches[0]:e,l=a.pageX-this.pointX,c=a.pageY-this.pointY,h=r.getTime();if(this.pointX=a.pageX,this.pointY=a.pageY,this.distX+=l,this.distY+=c,s=i.abs(this.distX),n=i.abs(this.distY),!(h-this.endTime>300&&s<10&&n<10)){if(this.directionLocked||this.options.freeScroll||(s>n+this.options.directionLockThreshold?this.directionLocked="h":n>=s+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)e.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);c=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)e.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);l=0}l=this.hasHorizontalScroll?l:0,c=this.hasVerticalScroll?c:0,t=this.x+l,o=this.y+c,(t>0||t<this.maxScrollX)&&(t=this.options.bounce?this.x+l/3:t>0?0:this.maxScrollX),(o>0||o<this.maxScrollY)&&(o=this.options.bounce?this.y+c/3:o>0?0:this.maxScrollY),this.directionX=l>0?-1:l<0?1:0,this.directionY=c>0?-1:c<0?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(t,o),h-this.startTime>300&&(this.startTime=h,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent("scroll")),this.options.probeType>1&&this._execEvent("scroll")}}},_end:function(e){if(this.enabled&&r.eventType[e.type]===this.initiated){this.options.preventDefault&&!r.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t,o,s=(e.changedTouches&&e.changedTouches[0],r.getTime()-this.startTime),n=i.round(this.x),a=i.round(this.y),l=i.abs(n-this.startX),c=i.abs(a-this.startY),h=0,d="";if(this.isInTransition=0,this.initiated=0,this.endTime=r.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(n,a),!this.moved)return this.options.tap&&r.tap(e,this.options.tap),this.options.click&&r.click(e),void this._execEvent("scrollCancel");if(this._events.flick&&s<200&&l<100&&c<100)return void this._execEvent("flick");if(this.options.momentum&&s<300&&(t=this.hasHorizontalScroll?r.momentum(this.x,this.startX,s,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:n,duration:0},o=this.hasVerticalScroll?r.momentum(this.y,this.startY,s,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:a,duration:0},n=t.destination,a=o.destination,h=i.max(t.duration,o.duration),this.isInTransition=1),this.options.snap){var u=this._nearestSnap(n,a);this.currentPage=u,h=this.options.snapSpeed||i.max(i.max(i.min(i.abs(n-u.x),1e3),i.min(i.abs(a-u.y),1e3)),300),n=u.x,a=u.y,this.directionX=0,this.directionY=0,d=this.options.bounceEasing}return n!=this.x||a!=this.y?((n>0||n<this.maxScrollX||a>0||a<this.maxScrollY)&&(d=r.ease.quadratic),void this.scrollTo(n,a,h,d)):void this._execEvent("scrollEnd")}}},_resize:function(){var e=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){e.refresh()},this.options.resizePolling)},resetPosition:function(e){var t=this.x,i=this.y;return e=e||0,!this.hasHorizontalScroll||this.x>0?t=0:this.x<this.maxScrollX&&(t=this.maxScrollX),!this.hasVerticalScroll||this.y>0?i=0:this.y<this.maxScrollY&&(i=this.maxScrollY),(t!=this.x||i!=this.y)&&(this.scrollTo(t,i,e,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){r.getRect(this.wrapper),this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight;var e=r.getRect(this.scroller);this.scrollerWidth=e.width,this.scrollerHeight=e.height,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,r.hasPointer&&!this.options.disablePointer&&(this.wrapper.style[r.style.touchAction]=r.getTouchAction(this.options.eventPassthrough,!0),this.wrapper.style[r.style.touchAction]||(this.wrapper.style[r.style.touchAction]=r.getTouchAction(this.options.eventPassthrough,!1))),this.wrapperOffset=r.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},off:function(e,t){if(this._events[e]){var i=this._events[e].indexOf(t);i>-1&&this._events[e].splice(i,1)}},_execEvent:function(e){if(this._events[e]){var t=0,i=this._events[e].length;if(i)for(;t<i;t++)this._events[e][t].apply(this,[].slice.call(arguments,1))}},scrollBy:function(e,t,i,o){e=this.x+e,t=this.y+t,i=i||0,this.scrollTo(e,t,i,o)},scrollTo:function(e,t,i,o){o=o||r.ease.circular,this.isInTransition=this.options.useTransition&&i>0;var s=this.options.useTransition&&o.style;!i||s?(s&&(this._transitionTimingFunction(o.style),this._transitionTime(i)),this._translate(e,t)):this._animate(e,t,i,o.fn)},scrollToElement:function(e,t,o,s,n){if(e=e.nodeType?e:this.scroller.querySelector(e)){var a=r.offset(e);a.left-=this.wrapperOffset.left,a.top-=this.wrapperOffset.top;var l=r.getRect(e),c=r.getRect(this.wrapper);!0===o&&(o=i.round(l.width/2-c.width/2)),!0===s&&(s=i.round(l.height/2-c.height/2)),a.left-=o||0,a.top-=s||0,a.left=a.left>0?0:a.left<this.maxScrollX?this.maxScrollX:a.left,a.top=a.top>0?0:a.top<this.maxScrollY?this.maxScrollY:a.top,t=void 0===t||null===t||"auto"===t?i.max(i.abs(this.x-a.left),i.abs(this.y-a.top)):t,this.scrollTo(a.left,a.top,t,n)}},_transitionTime:function(e){if(this.options.useTransition){e=e||0;var t=r.style.transitionDuration;if(t){if(this.scrollerStyle[t]=e+"ms",!e&&r.isBadAndroid){this.scrollerStyle[t]="0.0001ms";var i=this;a(function(){"0.0001ms"===i.scrollerStyle[t]&&(i.scrollerStyle[t]="0s")})}if(this.indicators)for(var o=this.indicators.length;o--;)this.indicators[o].transitionTime(e)}}},_transitionTimingFunction:function(e){if(this.scrollerStyle[r.style.transitionTimingFunction]=e,this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTimingFunction(e)},_translate:function(e,t){if(this.options.useTransform?this.scrollerStyle[r.style.transform]="translate("+e+"px,"+t+"px)"+this.translateZ:(e=i.round(e),t=i.round(t),this.scrollerStyle.left=e+"px",this.scrollerStyle.top=t+"px"),this.x=e,this.y=t,this.indicators)for(var o=this.indicators.length;o--;)this.indicators[o].updatePosition()},_initEvents:function(t){var i=t?r.removeEvent:r.addEvent,o=this.options.bindToWrapper?this.wrapper:e;i(e,"orientationchange",this),i(e,"resize",this),this.options.click&&i(this.wrapper,"click",this,!0),this.options.disableMouse||(i(this.wrapper,"mousedown",this),i(o,"mousemove",this),i(o,"mousecancel",this),i(o,"mouseup",this)),r.hasPointer&&!this.options.disablePointer&&(i(this.wrapper,r.prefixPointerEvent("pointerdown"),this),i(o,r.prefixPointerEvent("pointermove"),this),i(o,r.prefixPointerEvent("pointercancel"),this),i(o,r.prefixPointerEvent("pointerup"),this)),r.hasTouch&&!this.options.disableTouch&&(i(this.wrapper,"touchstart",this),i(o,"touchmove",this),i(o,"touchcancel",this),i(o,"touchend",this)),i(this.scroller,"transitionend",this),i(this.scroller,"webkitTransitionEnd",this),i(this.scroller,"oTransitionEnd",this),i(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var t,i,o=e.getComputedStyle(this.scroller,null);return this.options.useTransform?(o=o[r.style.transform].split(")")[0].split(", "),t=+(o[12]||o[4]),i=+(o[13]||o[5])):(t=+o.left.replace(/[^-\d.]/g,""),i=+o.top.replace(/[^-\d.]/g,"")),{x:t,y:i}},_initIndicators:function(){function e(e){if(r.indicators)for(var t=r.indicators.length;t--;)e.call(r.indicators[t])}var t,i=this.options.interactiveScrollbars,o="string"!=typeof this.options.scrollbars,a=[],r=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(t={el:s("v",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:o,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(t.el),a.push(t)),this.options.scrollX&&(t={el:s("h",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:o,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(t.el),a.push(t))),this.options.indicators&&(a=a.concat(this.options.indicators));for(var l=a.length;l--;)this.indicators.push(new n(this,a[l]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){e(function(){this.fade()})}),this.on("scrollCancel",function(){e(function(){this.fade()})}),this.on("scrollStart",function(){e(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){e(function(){this.fade(1,!0)})})),this.on("refresh",function(){e(function(){this.refresh()})}),this.on("destroy",function(){e(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){r.addEvent(this.wrapper,"wheel",this),r.addEvent(this.wrapper,"mousewheel",this),r.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){clearTimeout(this.wheelTimeout),this.wheelTimeout=null,r.removeEvent(this.wrapper,"wheel",this),r.removeEvent(this.wrapper,"mousewheel",this),r.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(e){if(this.enabled){e.preventDefault();var t,o,s,n,a=this;if(void 0===this.wheelTimeout&&a._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){a.options.snap||a._execEvent("scrollEnd"),a.wheelTimeout=void 0},400),"deltaX"in e)1===e.deltaMode?(t=-e.deltaX*this.options.mouseWheelSpeed,o=-e.deltaY*this.options.mouseWheelSpeed):(t=-e.deltaX,o=-e.deltaY);else if("wheelDeltaX"in e)t=e.wheelDeltaX/120*this.options.mouseWheelSpeed,o=e.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in e)t=o=e.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in e))return;t=o=-e.detail/3*this.options.mouseWheelSpeed}if(t*=this.options.invertWheelDirection,o*=this.options.invertWheelDirection,this.hasVerticalScroll||(t=o,o=0),this.options.snap)return s=this.currentPage.pageX,n=this.currentPage.pageY,t>0?s--:t<0&&s++,o>0?n--:o<0&&n++,void this.goToPage(s,n);s=this.x+i.round(this.hasHorizontalScroll?t:0),n=this.y+i.round(this.hasVerticalScroll?o:0),this.directionX=t>0?-1:t<0?1:0,this.directionY=o>0?-1:o<0?1:0,s>0?s=0:s<this.maxScrollX&&(s=this.maxScrollX),n>0?n=0:n<this.maxScrollY&&(n=this.maxScrollY),this.scrollTo(s,n,0),this.options.probeType>1&&this._execEvent("scroll")}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var e,t,o,s,n,a,l,c=0,h=0,d=0,u=this.options.snapStepX||this.wrapperWidth,p=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(!0===this.options.snap)for(o=i.round(u/2),s=i.round(p/2);d>-this.scrollerWidth;){for(this.pages[c]=[],e=0,n=0;n>-this.scrollerHeight;)this.pages[c][e]={x:i.max(d,this.maxScrollX),y:i.max(n,this.maxScrollY),width:u,height:p,cx:d-o,cy:n-s},n-=p,e++;d-=u,c++}else for(a=this.options.snap,e=a.length,t=-1;c<e;c++)l=r.getRect(a[c]),(0===c||l.left<=r.getRect(a[c-1]).left)&&(h=0,t++),this.pages[h]||(this.pages[h]=[]),d=i.max(-l.left,this.maxScrollX),n=i.max(-l.top,this.maxScrollY),o=d-i.round(l.width/2),s=n-i.round(l.height/2),this.pages[h][t]={x:d,y:n,width:l.width,height:l.height,cx:o,cy:s},d>this.maxScrollX&&h++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1==0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var e=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.x-this.startX),1e3),i.min(i.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,e)})},_nearestSnap:function(e,t){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var o=0,s=this.pages.length,n=0;if(i.abs(e-this.absStartX)<this.snapThresholdX&&i.abs(t-this.absStartY)<this.snapThresholdY)return this.currentPage;for(e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),t>0?t=0:t<this.maxScrollY&&(t=this.maxScrollY);o<s;o++)if(e>=this.pages[o][0].cx){e=this.pages[o][0].x;break}for(s=this.pages[o].length;n<s;n++)if(t>=this.pages[0][n].cy){t=this.pages[0][n].y;break}return o==this.currentPage.pageX&&((o+=this.directionX)<0?o=0:o>=this.pages.length&&(o=this.pages.length-1),e=this.pages[o][0].x),n==this.currentPage.pageY&&((n+=this.directionY)<0?n=0:n>=this.pages[0].length&&(n=this.pages[0].length-1),t=this.pages[0][n].y),{x:e,y:t,pageX:o,pageY:n}},goToPage:function(e,t,o,s){s=s||this.options.bounceEasing,e>=this.pages.length?e=this.pages.length-1:e<0&&(e=0),t>=this.pages[e].length?t=this.pages[e].length-1:t<0&&(t=0);var n=this.pages[e][t].x,a=this.pages[e][t].y;o=void 0===o?this.options.snapSpeed||i.max(i.max(i.min(i.abs(n-this.x),1e3),i.min(i.abs(a-this.y),1e3)),300):o,this.currentPage={x:n,y:a,pageX:e,pageY:t},this.scrollTo(n,a,o,s)},next:function(e,t){var i=this.currentPage.pageX,o=this.currentPage.pageY;++i>=this.pages.length&&this.hasVerticalScroll&&(i=0,o++),this.goToPage(i,o,e,t)},prev:function(e,t){var i=this.currentPage.pageX,o=this.currentPage.pageY;--i<0&&this.hasVerticalScroll&&(i=0,o--),this.goToPage(i,o,e,t)},_initKeys:function(t){var i,o={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(i in this.options.keyBindings)"string"==typeof this.options.keyBindings[i]&&(this.options.keyBindings[i]=this.options.keyBindings[i].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(i in o)this.options.keyBindings[i]=this.options.keyBindings[i]||o[i];r.addEvent(e,"keydown",this),this.on("destroy",function(){r.removeEvent(e,"keydown",this)})},_key:function(e){if(this.enabled){var t,o=this.options.snap,s=o?this.currentPage.pageX:this.x,n=o?this.currentPage.pageY:this.y,a=r.getTime(),l=this.keyTime||0;switch(this.options.useTransition&&this.isInTransition&&(t=this.getComputedPosition(),this._translate(i.round(t.x),i.round(t.y)),this.isInTransition=!1),this.keyAcceleration=a-l<200?i.min(this.keyAcceleration+.25,50):0,e.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?s+=o?1:this.wrapperWidth:n+=o?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?s-=o?1:this.wrapperWidth:n-=o?1:this.wrapperHeight;break;case this.options.keyBindings.end:s=o?this.pages.length-1:this.maxScrollX,n=o?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:s=0,n=0;break;case this.options.keyBindings.left:s+=o?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:n+=o?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:s-=o?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:n-=o?1:5+this.keyAcceleration>>0;break;default:return}if(o)return void this.goToPage(s,n);s>0?(s=0,this.keyAcceleration=0):s<this.maxScrollX&&(s=this.maxScrollX,this.keyAcceleration=0),n>0?(n=0,this.keyAcceleration=0):n<this.maxScrollY&&(n=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(s,n,0),this.keyTime=a}},_animate:function(e,t,i,o){function s(){var u,p,v,f=r.getTime();return f>=d?(n.isAnimating=!1,n._translate(e,t),void(n.resetPosition(n.options.bounceTime)||n._execEvent("scrollEnd"))):(f=(f-h)/i,v=o(f),u=(e-l)*v+l,p=(t-c)*v+c,n._translate(u,p),n.isAnimating&&a(s),void(3==n.options.probeType&&n._execEvent("scroll")))}var n=this,l=this.x,c=this.y,h=r.getTime(),d=h+i;this.isAnimating=!0,s()},handleEvent:function(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(e);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(e);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e);break;case"keydown":this._key(e);break;case"click":this.enabled&&!e._constructed&&(e.preventDefault(),e.stopPropagation())}}},n.prototype={handleEvent:function(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(e)}},destroy:function(){this.options.fadeScrollbars&&(clearTimeout(this.fadeTimeout),this.fadeTimeout=null),this.options.interactive&&(r.removeEvent(this.indicator,"touchstart",this),r.removeEvent(this.indicator,r.prefixPointerEvent("pointerdown"),this),r.removeEvent(this.indicator,"mousedown",this),r.removeEvent(e,"touchmove",this),r.removeEvent(e,r.prefixPointerEvent("pointermove"),this),r.removeEvent(e,"mousemove",this),r.removeEvent(e,"touchend",this),r.removeEvent(e,r.prefixPointerEvent("pointerup"),this),r.removeEvent(e,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(t){var i=t.touches?t.touches[0]:t;t.preventDefault(),t.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=i.pageX,this.lastPointY=i.pageY,this.startTime=r.getTime(),this.options.disableTouch||r.addEvent(e,"touchmove",this),this.options.disablePointer||r.addEvent(e,r.prefixPointerEvent("pointermove"),this),this.options.disableMouse||r.addEvent(e,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(e){var t,i,o,s,n=e.touches?e.touches[0]:e,a=r.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,t=n.pageX-this.lastPointX,this.lastPointX=n.pageX,i=n.pageY-this.lastPointY,this.lastPointY=n.pageY,o=this.x+t,s=this.y+i,this._pos(o,s),1==this.scroller.options.probeType&&a-this.startTime>300?(this.startTime=a,this.scroller._execEvent("scroll")):this.scroller.options.probeType>1&&this.scroller._execEvent("scroll"),e.preventDefault(),e.stopPropagation()},_end:function(t){if(this.initiated){if(this.initiated=!1,t.preventDefault(),t.stopPropagation(),r.removeEvent(e,"touchmove",this),r.removeEvent(e,r.prefixPointerEvent("pointermove"),this),r.removeEvent(e,"mousemove",this),this.scroller.options.snap){var o=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),s=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.scroller.x-o.x),1e3),i.min(i.abs(this.scroller.y-o.y),1e3)),300);this.scroller.x==o.x&&this.scroller.y==o.y||(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=o,this.scroller.scrollTo(o.x,o.y,s,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(e){e=e||0;var t=r.style.transitionDuration;if(t&&(this.indicatorStyle[t]=e+"ms",!e&&r.isBadAndroid)){this.indicatorStyle[t]="0.0001ms";var i=this;a(function(){"0.0001ms"===i.indicatorStyle[t]&&(i.indicatorStyle[t]="0s")})}},transitionTimingFunction:function(e){this.indicatorStyle[r.style.transitionTimingFunction]=e},refresh:function(){this.transitionTime(),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(r.addClass(this.wrapper,"iScrollBothScrollbars"),r.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(r.removeClass(this.wrapper,"iScrollBothScrollbars"),r.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px")),r.getRect(this.wrapper),this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=i.max(i.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=8-this.indicatorWidth,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=i.max(i.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=8-this.indicatorHeight,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var e=this.options.listenX&&i.round(this.sizeRatioX*this.scroller.x)||0,t=this.options.listenY&&i.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(e<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=i.max(this.indicatorWidth+e,8),this.indicatorStyle.width=this.width+"px"),e=this.minBoundaryX):e>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=i.max(this.indicatorWidth-(e-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",e=this.maxPosX+this.indicatorWidth-this.width):e=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),t<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=i.max(this.indicatorHeight+3*t,8),this.indicatorStyle.height=this.height+"px"),t=this.minBoundaryY):t>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=i.max(this.indicatorHeight-3*(t-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",t=this.maxPosY+this.indicatorHeight-this.height):t=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=e,this.y=t,this.scroller.options.useTransform?this.indicatorStyle[r.style.transform]="translate("+e+"px,"+t+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=e+"px",this.indicatorStyle.top=t+"px")},_pos:function(e,t){e<0?e=0:e>this.maxPosX&&(e=this.maxPosX),t<0?t=0:t>this.maxPosY&&(t=this.maxPosY),e=this.options.listenX?i.round(e/this.sizeRatioX):this.scroller.x,t=this.options.listenY?i.round(t/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(e,t)},fade:function(e,t){if(!t||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var i=e?250:500,o=e?0:300;e=e?"1":"0",this.wrapperStyle[r.style.transitionDuration]=i+"ms",this.fadeTimeout=setTimeout(function(e){this.wrapperStyle.opacity=e,this.visible=+e}.bind(this,e),o)}}},o.utils=r,"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd?define(function(){return o}):e.IScroll=o}(window,document,Math);var fileUtil={initChat:function(e){e||(view.chat={showTip:showTip,showDialog:showDialog,addMapParams:function(e){var t=[];for(var i in e)t.push(i+"="+encodeURIComponent(e[i]||""));return t.join("&")}})},orderUploadData:{length:0,max:20},prepareAddOrderFile:function(){var e=0;return function(t){view.orderUploadData[t.clientFileId]||view.orderUploadData.length++,view.orderUploadData[t.clientFileId]=t,t.index=++e,t.progress=t.progress||0;var i=4==t.fileType?'<span class="file-prev-video"><i>&#xe69a;</i><i>VIDEO</i></span>':'<span class="file-prev-img"></span>';$("#orderUpload"+t.index).remove(),$(".order-fileslist").append('<div class="orderUpload-item orderUpload-item-'+(4==t.fileType?"video":"img")+'" clientFileId="'+t.clientFileId+'" id="orderUpload'+e+'">'+i+'<span class="file-progress">'+(t.progress||0)+"%</span></div>"),view.orderUploadData.length>=view.orderUploadData.max&&$(view.uploadSelector||".order-button").addClass("limit-hide")}}(),updateOrderFile:function(e){if(2==e.sendStatus||4==e.sendStatus)return view.successOrderFile(e);var t=e.clientFileId,i=view.orderUploadData[t];i&&3==e.sendStatus?(view.chat.showTip(lanRes.uploadError||lanRes.visitor181),setTimeout(function(){view.removeOrderFile(e)},2e3)):i&&(view.orderUploadData[e.clientFileId]=$.extend(i,e),$(".file-progress",document.getElementById("orderUpload"+i.index)).html(e.progress+"%"))},successOrderFile:function(e){var t=e.clientFileId,i=view.orderUploadData[t];if(i&&3==e.sendStatus)return view.chat.showTip(lanRes.uploadError||lanRes.visitor181),void setTimeout(function(){view.removeOrderFile(e)},2e3);i&&(view.orderUploadData[e.clientFileId]=$.extend(i,e),EChatQuery(".file-progress",document.getElementById("orderUpload"+i.index)).remove(),EChatQuery(".file-prev-img",document.getElementById("orderUpload"+i.index)).remove(),4!=e.data.fileType?$("#orderUpload"+i.index).append('<img src="'+e.data.sourceUrl+'" onerror="this.className=\'file-prev-img\'" alt="" /><a class="file-remove"></a>'):$("#orderUpload"+i.index).append('<a class="file-remove"></a>'))},removeOrderFile:function(e){var t=e.clientFileId,i=view.orderUploadData[t];i&&(view.orderUploadData.length--,$("#orderUpload"+i.index).remove(),view.orderUploadData.length<view.orderUploadData.max&&$(view.uploadSelector||".order-button").removeClass("limit-hide"),delete view.orderUploadData[t])},bindOrderUpload:function(e,t){function i(e){var t=$(this.parentNode).attr("clientfileid"),i=view.orderUploadData[t];view.chat.showDialog({tip:lanRes.IsDel||lanRes.visitor191||"",ok:function(){var e=view.chat,o=view.getOrderParam(),s={token:o.token||"",nonce:o.nonce||"",key:i.data.key,bucket:i.data.bucket,companyId:o.companyId,requesterVisitorId:e.visitorId};EChatQuery._ajax({url:o.apiServerDomain+"/chatapi/jobh/df?"+e.addMapParams(s),type:"jsonp",jsonpCB:"jsonpCallback",success:function(i){e.showTip(lanRes.delSuccess||lanRes.visitor182||""),view.removeOrderFile(view.orderUploadData[t])}})}}),e.preventDefault(),e.stopPropagation()}view.uploadSelector=e,$(t||"#orderUpload").hide(),$("#orderFileMenu").off("click").remove(),$("body").append('<div id="orderFileMenu" class="file-menu hide"><div class="file-menu-item" type="camera"><i class="color0">&#xe6fc;</i><span>相机</span></div><div class="file-menu-item" type="gallery"><i class="color0">&#xe65e;</i><span>相册</span></div></div>'),$(e||".order-button").off("click").on("click",function(){view.orderUploadData.length>=view.orderUploadData.max?view.chat.showDialog({tip:lanRes.MaxFileNum||lanRes.visitor179,cancel:!1}):($("#orderFileMenu").removeClass("hide"),$("#orderMask").length||($("body").append('<div class="mask" id="orderMask" style="display:block;"></div>'),$("#orderMask").on("click",function(){$("#orderFileMenu").addClass("hide"),$("#orderMask").off("click").remove()})))}),$("#orderFileMenu").on("click",".file-menu-item",function(e){var t=$(this).attr("type"),i=view.getOrderParam();view.__nativeAPI("uploadMediaV2",{token:i.token,nonce:i.nonce,requestType:1,type:t,maxNum:view.orderUploadData.max-view.orderUploadData.length,isSave:0}),$("#orderFileMenu").addClass("hide"),$("#orderMask").off("click").remove()}),$(".order-fileslist").on("click",".orderUpload-item-img",function(e){var t=e.srcElement||e.target||{};if(-1!=t.className.indexOf("file-remove"))return i.call(t,e);var o=0,s=this,n=[];$(".orderUpload-item-img").each(function(e,t){var i=$(t).attr("clientfileid"),a=view.orderUploadData[i],r=a.data.sourceUrl;a&&(n.push({bigImg:r,smallImg:r,sourceImg:r,fileName:a.data.fname||"",identityKey:a.data.key,clientFileId:a.clientFileId,localFile:a.localFile}),s==t&&(o=n.length))}),view.__nativeAPI("previewImage",{urls:n,current:o}),e.preventDefault(),e.stopPropagation()}),$(".order-fileslist").on("click",".orderUpload-item-video",function(e){var t=e.srcElement||e.target||{};if(-1!=t.className.indexOf("file-remove"))return i.call(t,e);var o=$(this).attr("clientfileid"),s=view.orderUploadData[o],n=s.data&&s.data.sourceUrl,a=s.data&&s.data.fname;view.__nativeAPI("video",{type:"play",identityKey:s.data?s.data.key:"",clientFileId:s.clientFileId,url:n,localVideoPath:s.localFile,downloadUrl:function(e){return e?e+(-1==e.indexOf("?")?"?":"&")+"attname="+encodeURIComponent(a):""}(n),fileName:a})})},__playVideo:function(e,t,i,o,s){view.__nativeAPI("video",{type:"play",identityKey:s||"",clientFileId:s||"",url:e,thumbUrl:t,downloadUrl:i,fileName:o||""})}};!function(){var e={};window.view={SDK:!0,SDKNative:!0,media:6,urlList:[],fileMsgs:{},windowType:"",initViewEvent:function(e){view.chat||(view.chat=e,e.Device.media=6,e.queryParams.osName=e.queryParams.osName||(e.isIOS?"ios":"android"),e.mobile=!0,window.fileUtil&&EChatQuery.extend(window.view,window.fileUtil),view.getOrderParam=function(){var t=e.msg649&&e.msg649.jobWindowInfo||e.msg658||{};return{dataHost:view.chat.dataHost,apiServerDomain:view.chat.apiServerDomain,token:t.token||"",nonce:t.nonce||"",companyId:e.companyId,visitorId:e.visitorId}},view.bindEvent(e),view.checkView(e),view.bindMenu(e),view.initScroll(e),view.initInnerSite(),view.initNativeAPI(e),view.winH=window.innerHeight)},changeTitle:function(){},setDocumentTitle:function(){},initNativeAPI:function(e){UTIL.call(view,!0),ECHATObjKeyMap.viewId=view;var t;window.callEchatJs=function(e){console.log("callEchatJs:",e);try{var t;(t="string"==typeof e?JSON.parse(e+""):e).functionName&&i[t.functionName]&&i[t.functionName](t.value)}catch(e){console.log(e)}};var i={closeChat:function(t){e.visitorCloseFunc(1==t?1:0)},switchSoundTip:function(t){1==t?e.disableSoundTip=!1:0==t&&(e.disableSoundTip=!0)},triggerFile:function(e){view.triggerFile(e)},voice:function(e){var t;(t="string"==typeof e?JSON.parse(e+""):e).db&&t.db,t.timeout&&t.timeout;if("0"==t.init||1==t.init)view.initRecord&&view.initRecord(t.init);else if("db"==t.type||t.db){var i;i=t.db<3?0:(i=parseInt((t.db-0)/16))>5?5:i<1?1:i,$(".icon-record-sound").results[0].className="icon-record-sound echat icon-record-sound"+i}else"timeout"==t.type||t.timeout?(console.log("record-countdown",t.timeout),$("body").addClass("record-countdown"),$(".icon-record-countdown").html(t.timeout)):"success"==t.type&&view.endRecord&&view.endRecord()},uploadType:function(e){if(e){var t=2;"record"==e?t=4:"gallery"==e?t=2:"voice"==e&&(t=3);var i=document.getElementById("uploadInput");$(i).attr("filetype",t)}},location:function(e){view.chat;var t={id:(new Date).getTime(),et:127,locationX:e.latitude,locationY:e.longitude,scale:parseInt(e.zoom||15),label:e.title,address:e.address};view.chat.showLocation(t)},keyboardHeight:function(e){var i=window.innerHeight+e-view.winH;view.lastKeyboardHeight=e,(view.inputFocus||view.satisfyFocus)&&(i<3&&i>-3||window.innerHeight==_$("footer").getBoundingClientRect().bottom?window.scrollTo(0,view.winH):(t&&clearTimeout(t),t=setTimeout(function(){t=null;var i=_$("footer").getBoundingClientRect().bottom;if(window.innerHeight==i)return console.log(view.winH,e,window.innerHeight,"**innerHeight change"),void window.scrollTo(0,view.winH);var o=parseInt(window.getComputedStyle(_$("footer")).getPropertyValue("margin-bottom"))||0,s=e-view.winH+i+o;(s<3&&s>-3||window.innerHeight==i)&&(s=0),console.log(view.winH,i,e,o,"**500ms**",window.innerHeight,s),view.inputFocus&&(_$("footer").style.marginBottom=s+"px"),view.resetContainerBaseFoot(),view.satisfyFocus&&(_$("satisfyContent").style.marginBottom=s+"px")},600)))},callbackOpenFile:function(e){"0"==params.status&&view.chat.showTip("文件打开失败文件")},isNetworkConnected:function(e){"0"==e?(view.chat.isNetworkDisconnected=!0,$("#networkDisconnected").removeClass("hide")):1==e&&(view.chat.isNetworkDisconnected=!1,$("#networkDisconnected").addClass("hide"),view.restoreConnet());var t=$("#networkDisconnected").height()+$("#innerADWrap").height();$("#content").css("height",t?"calc(100% - "+t+"px)":"100%"),view.chatScroll&&view.chatScroll.refresh()},isGaodeMapExist:function(e){e+""!="true"&&$(".menu-map").addClass("hide").addClass("style-tool-hide")}};i.setKeyboardHeight=i.keyboardHeight,view.subscribe("__chatStatus",function(e,t){t&&t.match(/^leave/)?$("body").addClass("inleave"):$("body").removeClass("inleave")}),view.subscribe("__chatQueue",function(e,t){}),view.subscribe("__chatStaffInfo",function(e,t){}),view.subscribe("__visitorClose",function(e,t){o("visitorClose")}),view.subscribe("__evaluate",function(e,t){o("visitorEvaluate",t)}),view.subscribe("__visitorHide",function(e,t){o("closeView")}),view.subscribe("_closeWin",function(e,t){view.chat.visitorClose&&o("destoryView")}),view.subscribe("_hideCloseBtn",function(e,t){o("changeCloseBtnStatus","0")}),view.subscribe("__visitorStartSendMsg",function(e,t){o("visitorStartSendMsg",t)}),view.subscribe("__setTitle",function(e,t){o("setTitle",t)});var o=view.__nativeAPI},callbackIndex:0,__nativeAPI:function(t,i,o){if(t){if("uploadMedia"==t||"map"==t){if(view.handleNetwok())return!0}else"openUrl"==t&&(i.registerBridge||(i.registerBridge=7,i.isCanOtherHandle=1));console.log(arguments);try{var s={functionName:t,value:0===i?i:i||""};o&&"function"==typeof o&&(s.callback="callbackview_"+view.callbackIndex,e[s.callback]=function(){console.log("callbackview_***"+s.callback,arguments),o.apply(o,arguments),window[s.callback]=null},view.callbackIndex++),window.wkWebkit?window.webkit&&window.webkit.messageHandlers.callEchatNative.postMessage(JSON.stringify(s)):window.EchatJsBridge&&EchatJsBridge.callEchatNative(JSON.stringify(s))}catch(e){}}},handleNetwok:function(){if(view.chat.isNetworkDisconnected)return view.chat.showTip("网络已断开,请检查网络后重试"),!0},initInnerSite:function(){function e(){$("#visitorSite").hasClass("show-site")&&(setTimeout(function(){$("#visitorSite").removeClass("show-site")},10),history.replaceState(null,document.title,location.href.split("#")[0]),_$("visitorSite").innerHTML=""),$("#menuSite").hasClass("show-site")&&(setTimeout(function(){$("#menuSite").removeClass("show-site")},10),history.replaceState(null,document.title,location.href.split("#")[0]),_$("menuSite").innerHTML=""),$("#mask").hide().off("click",e),$("#footer").show()}view.hideURLSite=function(){e()},$("#menuSite").on("click",".menu-site-back-icon",function(){e()}),$("#visitorSite").on("click",".site-back",function(){e()}),window.addEventListener("popstate",function(){e()});72==view.chat.companyId&&($("#menuSite").addClass("can-scroll"),$("#visitorSite").addClass("can-scroll")),$("#urlList").on("click",".menu-url",function(e){var t=view.urlList[this.getAttribute("data-index")];if(t){t.title;var i=t.url;i&&(history.pushState&&history.pushState({title:"handle back"},document.title,location.href.split("#")[0]+"#TOSITE"),i=view.chat.getADURL(!0,view.chat.paramChat.staffId?t.openWindowParamList.concat(t.afterConnectParamList||[]):t.openWindowParamList,i,view.chat.paramChat,!1),view.__nativeAPI("openUrl",{url:i,openType:1==t.openType?"default":"half"}))}}),$("body").on("click","a",function(e){var t=this;if($.fn.contains(_$("list_his"),t)||$.fn.contains(_$("unread"),t)||$.fn.contains(_$("innerADWrap"),t)){var i=t.getAttribute("href");if(!i)return!1;var o=new RegExp("(^|\\?|&)talkId=([^&]*)(\\s|&|$)","i"),s=null;if(i.indexOf("/visitor/common/form.html")&&(s=i.match(o))){var n=s[2],a=s[0].replace(n,view.chat.talkId);i=i.replace(s[0],a)}var r=t.getAttribute("target");return"inner"==r||"menuSiteIframe"==r?view.__nativeAPI("openUrl",{url:i,openType:"half"}):r&&"cover"==r?view.__nativeAPI("openUrl",{url:i,openType:"coverChat"}):r&&"_blank"==r?view.__nativeAPI("openUrl",{url:i,openType:"default"}):r&&_$(r)?view.__nativeAPI("openUrl",{url:i,openType:"default"}):view.__nativeAPI("openUrl",{url:i,openType:"half"}),e.preventDefault&&e.preventDefault(),!1}}),view.showURLLink=function(e,t,i){var o={url:t,openType:"half"};i&&i.workorder?(o.openType="coverChat",o.registerBridge=15,o.isCanOtherHandle=0):i&&5==i.from&&(o.registerBridge=7,o.isCanOtherHandle=1),view.__nativeAPI("openUrl",o)}},setConfig:function(e,t,i){function o(t,i){if(i){var o=e.getCSSRule(t?".bg10":".bg1");i.chatStaffBackColor&&(o.style.backgroundColor=i.chatStaffBackColor),i.chatStaffBackColor&&(o.style.borderColor=i.chatStaffBackColor),i.chatStaffTxtColor&&(o.style.color=i.chatStaffTxtColor);var s=e.getCSSRule(t?".color10":".color11");i.chatStaffTxtColor&&(s.style.color=i.chatStaffBackColor);var n=e.getCSSRule(t?".bg30":".bg3");i.chatVisitorBackColor&&(n.style.backgroundColor=i.chatVisitorBackColor),i.chatVisitorBackColor&&(n.style.borderColor=i.chatVisitorBackColor),i.chatVisitorTxtColor&&(n.style.color=i.chatVisitorTxtColor);var a=e.getCSSRule(t?".color30":".color3");i.chatStaffTxtColor&&(a.style.color=i.chatVisitorBackColor);var r=e.getCSSRule(t?".msg-info0":".msg-info");i.sysMsgBackground&&(r.style.backgroundColor=i.sysMsgBackground),i.sysMsgFontColor&&(r.style.color=i.sysMsgFontColor)}}view.chat.companyId&&"522166"!=view.chat.companyId&&$(".record-switch").removeClass("limit-hide");var s,n=i||(view.chat.isInRobot?t.robotSdkChatBox:t.sdkChatBoxInfo);if(view.chat.showAvatar=1==n.chatBoxStaffImgEnable,n){var a={chatColor:n.chatColor||n.chatThemeBackColor,chatThemeTxtColor:n.chatThemeTxtColor,chatStaffBackColor:n.chatStaffBackColor,chatStaffTxtColor:n.chatStaffTxtColor,chatVisitorBackColor:n.chatVisitorBackColor,chatVisitorTxtColor:n.chatVisitorTxtColor,evaluateThemeColor:n.evaluateThemeColor};if(!t.notStore){var r=e.getCSSRule(".bg0");a.chatColor&&(r.style.backgroundColor=a.chatColor),a.chatThemeTxtColor&&(r.style.color=a.chatThemeTxtColor);var l=e.getCSSRule(".border0");a.chatColor&&(l.style.borderColor=a.chatColor);var c=e.getCSSRule(".color0");a.chatColor&&(c.style.color=a.chatColor);var h=view.chat.getBackground(n.windowThemeBackColor,n.windowThemeBackTransparency);if(n.sysMsgBackground){e.getCSSRule(".color1").style.color=n.windowTextColor;e.getCSSRule(".msg-staff-name").style.color=n.windowTextColor;var d=e.getCSSRule(".hr-left");d.style.backgroundColor=n.windowTextColor;var u=e.getCSSRule(".hr-right");u.style.backgroundColor=n.windowTextColor}if(n.windowThemeBackColor){e.getCSSRule(".bg4").style.backgroundColor=h,d.style.background="linear-gradient(to right,"+h+" 0%, "+n.windowTextColor+" 40%, "+n.windowTextColor+" 100%)",u.style.background="linear-gradient(to left,"+h+" 0%, "+n.windowTextColor+" 40%, "+n.windowTextColor+" 100%)"}var p=e.getCSSRule(".emcolor"),v=e.getCSSRule(".embgcolor"),f=e.getCSSRule("body .sub-selected");a.evaluateThemeColor&&(f.style.color=a.evaluateThemeColor,f.style.borderColor=a.evaluateThemeColor,p.style.color=a.evaluateThemeColor,v.style.backgroundColor=a.evaluateThemeColor)}if((s=$.store("ECHAT_"+view.chat.companyId+"_649"))&&(s=JSON.parse(s),t=$.extend(s,t)),o(!1,t.sdkChatBoxInfo),o(!0,t.robotSdkChatBox),!t.notStore){if(view.chat.getInput()?($(".menu-more").hide(),$("#enter_btn").removeClass("hide")):($(".menu-more").show(),$("#enter_btn").addClass("hide")),setTimeout(function(){view.chat.isInRobot&&5==view.urlList.length?$("#chat_text").addClass("enter-show"):$("#chat_text").removeClass("enter-show")},10),n.sdkUrlList){var m=JSON.parse(n.sdkUrlList);if(m&&0!=m.length){$(".menu-url").remove(),$(".url-list-pagemore").remove();var g="",w="",y=['<li class="dot-list-li hover">0</li>'],b=0;m=view.urlList=new Array(5).concat(m);for(var S=5;S<m.length;S++)view.chat.needHttps&&(m[S].url=m[S].url.replace(/^http:/i,view.chat.needHttps),m[S].icon=m[S].icon.replace(/^http:/i,view.chat.needHttps)),w='<li class="list-url-item menu-url" data-index="'+S+'"><div class="list-url-img"><div class="menu-item-icon border0"><img src="'+m[S].icon+'" class="list-url-icon" /></div></div><div class="list-url-title">'+m[S].title+"</div></li>",7==S?($("#urlListPage1").append(g+w),g=""):S>7&&(S+1)%8==0?g+=w+"</ul>":S%8==0?(g+='<ul class="clearfix url-list-page flex1 url-list-pagemore">'+w,b++,y.push("<li class='dot-list-li'>"+b+"</li>")):g+=w;$("#urlListWrap").css({width:100*(b+1)+"%",transform:"translate(0px, 0px)"}).attr("x2","0").attr("x2","0"),S<8?$("#urlListPage1").append(g):S>8&&(g+="</ul></div>",$("#urlListWrap").append(g)),!view.urlListPageCallback||b>0?(view.urlListPageNum=0,view.urlListToPage=function(e){$($(".dot-list-li",_$("url_dot_list")).removeClass("hover").results[e||0]).addClass("hover"),$("#urlListWrap").css({transform:"translate(-"+window.innerWidth*e+"px, 0px)"}).attr("x2","0").attr("x","-"+window.innerWidth*e),view.urlListPageNum=e},view.urlListPageCallback=function(e){if(0!=e){view.urlListPageNum=view.urlListPageNum+e,view.urlListPageNum>b&&(view.urlListPageNum=b),view.urlListPageNum<0&&(view.urlListPageNum=0);$(".dot-list-li",_$("url_dot_list")).removeClass("hover");$($(".dot-list-li",_$("url_dot_list")).removeClass("hover").results[view.urlListPageNum]).addClass("hover")}},0==b?$("#url_dot_list").hide():(_$("url_dot_list").innerHTML=y.join(""),view.chat.pageSlide("#urlListWrap",view.urlListPageCallback),$("#url_dot_list").show())):($("#url_dot_list").hide(),view.urlListToPage&&view.urlListToPage(0)),view.hideMenus()}else view.urlList=new Array(5)}else view.urlList=new Array(5);(document.body||document.documentElement).style.display="block",view.chat.isIOS&&$("body").addClass("ios")}}},getADURL:function(e,t,i,o,s,n){if(!i)return"";if(!e||!t)return i;var a="",r=i.split("#"),l=r[1]||"",c=r[0],h=-1==c.indexOf("?")?0:1,d="?";s&&(d="",h=l?1:0),"string"==typeof t&&(t=JSON.parse(t));var u,p,v,f,m,g=["companyId","visitorId","echatTag","lan","country","province","city","searcher","keyword","metaData","formData","myData","referrer","firstUrl","chatPage","chatPageTitle","eventId","staffId","staffName","staffPhoto","talkId"],w=0;if(view.chat.isArray(t)&&t.length)for(u=t.length,v=0;v<g.length&&("staffId"!=(f=g[v])||o.staffId);v++)for(p=0;p<u;p++)if("metaData"!=(m=t[p].paramName)&&"metadata"!=m||(m="metaData"),"formData"!=m&&"formdata"!=m||(m="formData"),m==f){"metaData"==m?(w=1,a+=(0!=h?"&":d)+m+"="+encodeURIComponent(o[m]||""),m="myData",a+=(0!=++h?"&":d)+m+"="+encodeURIComponent(o[m]||""),h++,o[m="info"]&&(a+=(0!=h?"&":d)+m+"="+encodeURIComponent(o[m]||""),h++)):"myData"==m?w||(a+=(0!=h?"&":d)+m+"="+encodeURIComponent(o[m]||""),h++):(a+=(0!=h?"&":d)+m+"="+encodeURIComponent(o[m]||""),h++);break}return s?i+"#"+l+a:c+a+(l?"#"+l:"")},setInnerAD:function(e){view.chat.setInnerAD({data:view.chat.isInRobot?e.robotSdkChatBox:e.sdkChatBoxInfo,height:function(e){e&&$("#innerADWrap").css("height",e+"px"),$("#content").css("height",e&&$("#innerADWrap").height()||$("#networkDisconnected").height()?"calc(100% - "+(e+$("#networkDisconnected").height())+"px)":"100%"),view.chatScroll&&view.chatScroll.refresh()}})},hideStaffInfo:function(){},initServiceInfo:function(e,t){view.hasStaffInfo=!0;var i=e.staffName||"";$("#staffName").html("<span>"+i+"</span>"),t.staffPhone?($(".menu-phone-a").attr("href","tel:"+t.staffPhone),$(".menu-phone").removeClass("hide").removeClass("limit-hide")):$(".menu-phone").addClass("hide"),$(".sa-avatar").html('<img src="'+view.chat.staffImg+'"/>');var o={name:i||lanRes.onlineService,url:view.chat.staffImg,tel:t.staffPhone,list:[{name:lanRes.intro,content:t.staffInfo},{name:lanRes.telephone,content:t.staffPhone}]};view.chat.needHttps&&o.url&&(o.url=o.url.replace(/^http:/,view.chat.needHttps)),$("#portrait").html(' <div class="flex1"><a id="back_chat"><div class="portrait-back echat"></div><div>'+lanRes.backToChat+'</div></a></div><div id="service_icon" class=""><div class="portrait-wrap"><img src="'+o.url+'" ></div><h2 class="tc portrait-name">'+o.name+'</h2></div><div class="flex1">'+(o.tel?'<a href="tel:'+o.tel+'" target="_blank"><div class="portrait-tel echat" ></div><div>'+lanRes.makeCall+"</div></a>":"")+"</div>");for(var s=[],n=['<section class="info bg6">'],a=o.list,r=0;r<a.length;r++)a[r].content&&(a[r].name==lanRes.telephone?(n.push('<div class="info-item"><label class="info-name inline color0">'),n.push(a[r].name),n.push('</label><a class="info-content inline" href="tel:'+o.tel+'">'),n.push(a[r].content),n.push("</a></div>")):a[r].content.length>18?(s.push('<section class="info bg6"><div class="info-item"><label class="info-name block color0">'),s.push(a[r].name),s.push('</label><div class="info-content block">'),s.push(a[r].content),s.push("</div></div></section>")):(n.push('<div class="info-item"><label class="info-name inline color0">'),n.push(a[r].name),n.push('</label><div class="info-content inline">'),n.push(a[r].content),n.push("</div></div>")));n.push("</section>"),$("#info_list").html(s.join("")+n.join("")),setTimeout(function(){view.infoScroll.refresh(),_$("back_chat").addEventListener("tap",function(){view.backToChat()})},150)},initRobotInfo:function(e,t){$("#staffName").html(view.chat.staffName||lanRes.robotName)},afterSend:function(){return view.textInputChange(),$(".menu-more-robot").show(),$("#enter_btn").addClass("hide"),view.hideMenus(null,!0)},initScroll:function(){window.vConsole&&setTimeout(function(){$("#__vc_log_default").css({height:.85*$("body").height()-111+"px",position:"relative",zIndex:1}),view.logScroll=new IScroll("#__vc_log_default",view.chat.iScrollParam),setInterval(function(){view.logScroll.refresh()},1e3)},3e3),view.infoScroll=new IScroll("#detail",view.chat.iScrollParam),view.initChatscroll()},initChatscroll:function(){if(!view.chatScroll)if(!view.chat.Browser.isIOS||view.chat.Browser.osVersion<13)view.chatScroll=new IScroll("#content",view.chat.iScrollParam);else{document.addEventListener("touchmove",function(e){e.stopPropagation(),e.preventDefault()},!1),_$("content").style.overflowY="auto";var e={scrollTo:function(e,t){console.log("scrollto",e,t),_$("content").scrollTo(e,-t)},refresh:function(){}};Object.defineProperty(e,"maxScrollY",{enumerable:!1,configurable:!1,get:function(){return-_$("content").scrollHeight+_$("content").clientHeight}}),Object.defineProperty(e,"y",{enumerable:!1,configurable:!1,get:function(){return-_$("content").scrollTop}}),view.chatScroll=e}},enter:function(e){if(13==((e=e||window.event).keyCode||e.which||e.charCode||0))return view.chat.publish("_sendMsg"),e.preventDefault&&e.preventDefault(),!1},bindEvent:function(e){function t(e,t,o){i=!0,view.__nativeAPI(e,t),setTimeout(function(){i=!1},700)}$("#sa_advise").on("blur",function(){window.scrollTo(0,0)}),$("#content").on("swipeLeft",function(e){$.fn.contains(_$("toolbar"),e.target)||(view.showDetailPage(),view.chat.getInputDocBody().blur())}).on("click",function(e){view.chat.getInputDocBody().blur()}).on("click",".staff-icons",function(e){view.showDetailPage(),view.chat.getInputDocBody().blur()}).on("click",".msg-voice",function(e){var i=$(this).attr("identity"),o=view.fileMsgs[i],s=this;t("voice",{type:"play",identityKey:o.identityKey||o.fileIdentity,clientFileId:o.clientFileId,url:o.remoteFileUrl,localFile:o.localFile});var n=o.duration,a=o.clientFileId;view.lastPlayVoiceTimer&&clearTimeout(view.lastPlayVoiceTimer),view.lastPlayVoiceTimer=null,view.lastPlayingVoiceId==a?($(s).removeClass("playing"),view.lastPlayingVoiceId=null):(view.lastPlayingVoiceId&&$(".msg-voice").each(function(e,t){if($(t).attr("identity")==view.lastPlayingVoiceId)return $(t).removeClass("playing"),!0}),view.lastPlayingVoiceId=a,view.lastPlayVoiceTimer=setTimeout(function(){$(s).removeClass("playing"),view.lastPlayingVoiceId=null},n),$(s).addClass("playing"))}).on("click",".msg-video",function(e){var i=$(this).attr("identity"),o=view.fileMsgs[i],s=o.fileName||(new Date).getTime()+".mp4";t("video",{type:"play",identityKey:o.identityKey||o.fileIdentity,clientFileId:o.clientFileId,url:o.remoteVideoPath||o.localVideoPath||o.remoteFileUrl||o.fileUrl,localVideoPath:o.localVideoPath,downloadUrl:function(){var e=o.remoteVideoPath||o.remoteFileUrl||o.fileUrl;return e?e+(-1==e.indexOf("?")?"?":"&")+"attname="+encodeURIComponent(s):o.localVideoPath||""}(),fileName:s})}).on("click",".msg-videotag",function(e){var i=$(this).attr("videourl"),o=i.split("/"),s=o[o.length-1];1===s.split(".").length&&(s=(new Date).getTime()+".mp4"),t("video",{type:"play",url:i})}).on("click",".msg-imgs",function(e){view.showImg.call(this,view.chat,e)}).on("click",".msg-img",function(e){view.showImg.call(this,view.chat,e)}).on("click",".file-resend",function(t){if(!view.handleNetwok()){var i=$(this).attr("identity"),o=view.fileMsgs[i];i&&o&&e.showDialog({tip:lanRes.visitor192,ok:function(){view.chat.publish("__callNative",{functionName:"resendFile",value:o.clientFileId})}}),$(this).attr("resend","1")}}).on("click",".msg-file",function(e){var t=$(this).attr("identity"),i=view.fileMsgs[t];if(i){var o;if(0==i.loadStatus||3==i.loadStatus||4==i.loadStatus){if(view.handleNetwok())return;i.loadStatus=2,view.chat.publish("__callNative",{functionName:"downloadFile",value:{identityKey:i.fileIdentity,isNeedOpen:0,downloadType:0}}),this.className="file-load-btn file-load-status2",o="0%",$(".file-load-progress0",this).css("width","0px")}else 2==i.loadStatus?(view.chat.publish("__callNative",{functionName:"cancelDownloadFile",value:{identityKey:i.fileIdentity}}),i.loadStatus=3,o="点击重新下载"):1==i.loadStatus&&view.__nativeAPI("openFile",{identityKey:i.fileIdentity,clientFileId:i.clientFileId,localFile:i.localFile});this.className="msg-file file-load-status"+i.loadStatus,o&&$(".file-load-bar-info",this).html(o)}});var i=!1;$("#detail").on("swipeRight",function(e){view.backToChat()}),$("#to_detail").bind("click",function(){view.showDetailPage.call(e,this)}),$("#textInput").on("propertychange change input paste drop",function(e){setTimeout(function(){view.textInputChange(),view.chat.handleInputLength&&view.chat.handleInputLength()})})},inputBlur:function(e,t){t&&_$("sa_advise").blur(),!0!==view.inputFocus||e&&e.target&&"textInput"==e.target.id||(_$("textInput").blur(),setTimeout(function(){_$("textInput").blur(),window.scrollTo(0,0)},10),window.blur())},bindPlainTextEvent:function(){var e=navigator.userAgent.match(/os ([\d]+)/i),t=_$("textInput");e=e&&e[1];var i=function(e){e.target!=t&&(t.blur(),document.removeEventListener("touchend",i,!1))};window.screen.width,window.screen.height;$("#textInput").on("focus",function(){view.inputFocus=!0,view.hideMenus(),view.scrollToBottom(),document.addEventListener("touchend",i,!1),view.__nativeAPI("toggleTitleBar",0)}).on("blur",function(e){document.body.scrollTop=0,view.inputFocus=!1,_$("footer").style.marginBottom="0px",view.resetContainerBaseFoot(),view.scrollToBottom(),view.__nativeAPI("toggleTitleBar",1)}).on("touchstart touchmove touchend",function(e){e.stopPropagation()})},textInputChange:function(){var e=_$("fakeInput"),t=_$("textInput");e.innerText=t.value||" ",setTimeout(function(){if(!(parseInt(_$("textInput").style.height)>90&&e.clientHeight>92)){var i=e.clientHeight;i>92?i=93:i<33&&(i=33),t.style.height=i+"px",t.setAttribute("height",i),t.style.width="auto",t=e=null}},10)},initHtmlEdit:function(e){var t=view.chat.getInputDocBody();$(t).on("focus",function(e){if(view.chatScroll){var t=window.innerHeight;setTimeout(function(){var e=window.innerHeight;t-e>100&&view.scrollToBottom()},500)}})},checkView:function(e){var t=0;document.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()}),document.addEventListener("touchend",function(e){var i=(new Date).getTime();i-t<=500&&e.preventDefault(),t=i},!1),document.addEventListener("gesturestart",function(e){e.preventDefault()}),window.resizeFunc=function(){console.log("resizeFunc");var e=window.innerHeight||document.body.clientHeight;view.winH<e&&(view.winH=e),view.chatScroll&&(view.chatScroll.refresh(),view.scrollToBottom(null,{timeout:500})),window.innerHeight==view.winH&&(window.scrollTo(0,0),document.body.scrollTop=0,window.scrollTop=0,$("#footer").css("bottom","0px"),view.resetContainerBaseFoot()),$("#satisfy").height()>100&&view.handleShowSatisfy()},window.addEventListener("resize",resizeFunc),window.addEventListener("orientationchange",resizeFunc),resizeFunc()},triggerFile:function(e){console.log("triggerFile",e);var t=2;"record"==e?t=4:"gallery"==e?t=2:"voice"==e&&(t=3);var i=document.getElementById("uploadInput");if($(i).attr("filetype",t),document.createEvent)try{var o=document.createEvent("mouseEvent");o.initEvent("click",!0,!0),i.dispatchEvent(o)}catch(e){i.click(),console.log(e)}else i.click()},bindMenu:function(e){e.companyId&&"522166"!=e.companyId&&$(".record-switch").removeClass("limit-hide"),$("#menu_emotion").off("touchend").on("touchend",function(e){view.inputFocus?setTimeout(function(){view.showMenu("emotion")},550):$(this).hasClass("open")?view.hideMenus():view.showMenu("emotion"),_$("textInput").blur()}),$("#menu_more").off("touchend").on("touchend",function(e){return view.inputFocus?setTimeout(function(){view.showMenu("urlList"),view.scrollToBottom()},550):$(this).hasClass("open")?view.hideMenus():(view.showMenu("urlList"),view.scrollToBottom()),_$("textInput").blur(),e&&e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}),$(".menu-satisfy").on("click",function(){e.showSatisfy(3)}),$(".menu-camera").on("click",function(){view.__nativeAPI("uploadMedia","camera"),view.hideMenus()}),$(".menu-video").on("click",function(){view.__nativeAPI("uploadMedia","camera"),view.hideMenus()}),$(".menu-file").on("click",function(){view.__nativeAPI("uploadMedia","gallery"),view.hideMenus()}),$(".menu-map").on("click",function(){view.__nativeAPI("map"),view.hideMenus()}),$(".record-switch").on("tap",function(){$("#chat_text").hasClass("recording")?$("#chat_text").removeClass("recording"):$("#chat_text").addClass("recording")});var t,i="getSelection"in window?function(){window.getSelection().removeAllRanges()}:function(){document.selection.empty()},o=-1;$(".btn-record").on("contextmenu",function(e){e.preventDefault&&e.preventDefault()}).on("touchstart",function(e){function s(e){i(),l=t?e:e.touches[0],c.x2=l.pageX,c.y2=l.pageY,1!=o&&2!=o||(a=Math.abs(c.x1-c.x2),(r=Math.abs(c.y1-c.y2))>30?1==o&&($("body").addClass("record-canceling"),view.__nativeAPI("voice",{type:"willcancelrecord"}),o=2):2==o&&($("body").removeClass("record-canceling"),view.__nativeAPI("voice",{type:"continuerecord"}),o=1))}function n(e){view.__nativeAPI("voice",{type:"stoprecord"}),view.endRecord&&view.endRecord()}if(view.handleNetwok())return!0;i();var a,r,l=t?e:e.touches[0];if(!(t=function(e,t){return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t}(e,"down"))||function(e){return("touch"==e.pointerType||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary}(e)){var c={x1:l.pageX,y1:l.pageY,start:(new Date).getTime()};o=0,view.initRecord=function(e){view.initRecord=null,0===o&&(1==e?($("body").addClass("record-touching"),$("body").removeClass("record-canceling"),$("body").removeClass("record-countdown"),$(".btn-record").html(lanRes.visitor194),view.__nativeAPI("voice",{type:"startrecord"}),o=1):view.chat.showTip("请打开麦克风权限"))},setTimeout(function(){0==o&&view.__nativeAPI("voice",{type:"init",record_time:60})},0),view.endRecord=function(){o=-1,$("body").removeClass("record-touching"),$("body").removeClass("record-canceling"),$(".btn-record").html(lanRes.visitor193),$(document).off("touchmove",s),$(document).off("touchend",n),i(),view.endRecord=null},$(document).on("touchmove",s).on("touchend",n),e.preventDefault&&e.preventDefault()}})},sendClick:function(){this.publish("_sendMsg")},showDetailPage:function(e){if(view.hasStaffInfo){var t=$("#chat"),i=$("#detail");$("#detail").css("z-index","999999"),view.animate(t,i,!1,"slide",function(){}),$("#footer").hide(),setTimeout(function(){view.infoScroll.refresh()},550)}},backToChat:function(){var e=$("#chat"),t=$("#detail");view.animate(t,e,!0,"slide",function(){}),setTimeout(function(){view.chatScroll.refresh(),$("#footer").show()},550)},resetContainerBaseFoot:function(e){var t=window.getComputedStyle(_$("footer")),i=_$("footer").clientHeight,o=parseInt(t.getPropertyValue("margin-bottom"))||0,s=parseInt(t.getPropertyValue("bottom"))||0;$("#container").css("padding-bottom",i+o+s+"px")},showMenu:function(e){view.menuTimer&&clearTimeout(view.menuTimer),e="#"+(e||"urlList");var t,i,o=$(e);"#emotion"==e?(t=206,i="#urlList",$("#chat_text").removeClass("recording")):"#urlList"==e&&(t=view.calcUrlList(),i="#emotion"),$("#chat").off("click",view.hideMenus),$("#container").css("padding-bottom",t+53+"px"),$("#footer").css("bottom",t+"px"),setTimeout(function(){$("#chat").on("click",view.hideMenus)},20),"#urlList"==e?($(".menu-more").addClass("open"),$(".menu-more-i").addClass("color0"),$(".menu-emo").removeClass("open"),$(".menu-emo").removeClass("color0")):($(".menu-more").removeClass("open"),$(".menu-more-i").removeClass("color0"),$(".menu-emo").addClass("open"),$(".menu-emo").addClass("color0"),_$("textInput").blur()),o.removeClass("ani-hide"),$(i).addClass("ani-hide"),setTimeout(function(){o.removeClass("hide")}),view.menuTimer=setTimeout(function(){$(i).addClass("hide").removeClass("ani-hide")},200),setTimeout(function(){view.scrollToBottom(null,{transitionDuration:100,timeout:10})},550)},calcUrlList:function(e){var t,i,o,s,n,a=0;$("#urlList").hasClass("hide");$(".url-list-page").each(function(e,t){$(t).hasClass("hide")||a++});for(var r=$(".list-url-item",_$("urlListPage1")).results,l=0,c=0;c<5;c++)"none"==window.getComputedStyle(r[c]).getPropertyValue("display")&&l++;return view.menuNum=i=view.urlList.length-l,t=r.length-8-l,pages=$(".url-list-page"),pagesLength=pages.results.length,t<0?(t=0-t,pages.each(function(e,i){var o;if(e>0&&(o=$(".menu-url",i).results).length)for(var s=0;s<t;s++)o[s]&&pages.results[e-1].appendChild(o[s])})):t>0&&pages.each(function(e,i){var o,s;if(e<pagesLength-1){$(pages.results[e+1]).removeClass("hide"),o=$(".menu-url",i).results,s=$(".menu-url",pages.results[e+1]).results[0];for(var n=0;n<t;n++)s?o[o.length-1-n]&&pages.results[e+1].insertBefore(o[o.length-1-n],null):o[o.length-1-n]&&pages.results[e+1].appendChild(o[o.length-1-n])}}),i<1?h=0:i<5?n=114:i&&(n=232),$("#urlList").css({height:n+"px",bottom:-n+"px"}),o=parseInt(view.urlList.length/8)+(view.urlList.length%8>0?1:0),s=parseInt(i/8)+(i%8>0?1:0),a==s&&o==s||($("#urlListWrap").css({width:100*s+"%",transform:"translate(0px, 0px)"}).attr("x","").attr("x2",""),$(".url-list-page").removeClass("hide").each(function(e,t){e+1>s?$(t).addClass("hide"):$(t).removeClass("hide")}),1==s?$("#url_dot_list").hide():$("#url_dot_list").show(),$(".dot-list-li",_$("url_dot_list")).removeClass("hide").removeClass("hover").each(function(e,t){e+1>s?$(t).addClass("hide"):$(t).removeClass("hide")})),n},showURLList:function(e){return view.showMenu(e)},hideMenus:function(e,t){view.menuTimer&&clearTimeout(view.menuTimer);var i;if(!t&&e){i=e&&e.target?e.target:window.event?window.event.srcElement:null;var o=_$("menu_emotion"),s=_$("emotion"),n=_$("menu_more"),a=_$("urlList");if(i&&(i==o||n==i||a==i||s==i||$.fn.contains(o,i)||$.fn.contains(n,i)||$.fn.contains(s,i)||$.fn.contains(a,i)))return}$("#chat").off("click",view.hideMenus),setTimeout(function(){$("#container").css("padding-bottom",$("#footer").height()+"px"),$("#footer").css("bottom","0px")},100),$("#emotion").hasClass("hide")?$("#emotion").addClass("ani-hide"):$("#urlList").hasClass("hide")&&$("#urlList").addClass("ani-hide"),view.menuTimer=setTimeout(function(){$("#emotion").addClass("hide").removeClass("ani-hide"),$("#urlList").addClass("hide").removeClass("ani-hide")},500),$(".menu-more").removeClass("open"),$(".menu-more-i").removeClass("color0"),$(".menu-emo").removeClass("open"),$(".menu-emo").removeClass("color0"),setTimeout(function(){}),setTimeout(function(){view.scrollToBottom(null,{transitionDuration:100,timeout:10})},550)},showImg:function(e,t){var i=[],o=0,s=t.target;"IMG"!=s.tagName&&(s=(s=$("img",s.parentNode)).results[0]||null),$(".msg-img",_$("container")).each(function(e,t){var n,a,r=$(t),l={},c=r.attr("src");(l=view.fileMsgs[r.attr("identity")])?(a=(a=(l.fileName||"temp.png").match(/[^.]+$/))&&a[0]||"png",i.push({bigImg:l.bigImg||l.localFile,smallImg:l.smallImg,sourceImg:l.sourceImg,fileName:(l.identityKey||l.fileIdentity)+"."+a,identityKey:l.identityKey||l.fileIdentity,clientFileId:l.clientFileId,localFile:l.localFile}),s==t&&(o=i.length)):(n=(new Date).getTime()+"",a=(a=(c||"temp.png").match(/[^.]+$/))&&a[0]||"png",i.push({bigImg:c,smallImg:c,sourceImg:c,fileName:n+"."+a,identityKey:n,clientFileId:n,isOrignal:1}),s==t&&(o=i.length))}),view.__nativeAPI("previewImage",{urls:i,current:o})},animate:function(e,t,i,o,s){if(view.curPage!=t.attr("id")){window.setTimeout(function(){""!=e?(e.addClass(o+" out"),t.show(),t.addClass(o+" in"),i&&(e.addClass("reverse"),t.addClass("reverse"))):t.show()},1),window.setTimeout(function(){""!=e&&(e.removeClass(o+" out"),t.removeClass(o+" in"),e.removeClass("reverse"),t.removeClass("reverse"),e.hide(),t.show(),view.curPage=t.attr("id"))},505)}},animateUpShow:function(e,t){setTimeout(function(){e.addClass("slideup in"),e.show(),t&&e.addClass("reverse"),setTimeout(function(){e.removeClass("slideup in"),e.removeClass("reverse"),e.removeClass("reverse")},505)},1)},animateUpHide:function(e,t){setTimeout(function(){e.addClass("slideup out"),t&&e.addClass("reverse"),setTimeout(function(){e.removeClass("slideup in"),e.removeClass("reverse"),e.removeClass("reverse"),e.hide()},505)},1)},scrollTimer:null,scrollToBottomTimeout:0,scrollToBottom:function(e,t){if(view.chatScroll){if(view.preHisLoadingId)return view.scrollToLastPre(view.preHisLoadingId);if(view.noScrollBottom)view.chatScroll&&view.chatScroll.refresh();else{t=t||{};e?(_$(e).offsetTop,$("#"+e).height()):_$("list_his").scrollHeight;var i=$("#content").height(),o=t.timeout,s=t.transitionDuration||0;if(view.chatScroll){if(view.chatScroll&&view.chatScroll.refresh(),view.scrollTimer&&view.scrollToBottomTimeout&&o&&o<view.scrollToBottomTimeout)return;view.scrollTimer&&clearTimeout(view.scrollTimer),view.scrollToBottomTimeout=o||0;var n=setTimeout(function(){if(view.chatScroll){view.scrollToBottomTimeout=0,view.chatScroll.refresh(),i=$("#content").height();var t=e?i-(_$(e).offsetTop+$("#"+e).height()+15):view.chatScroll.maxScrollY;view.chatScroll.scrollTo(0,t>0?0:t,s),view.scrollTimer=null}},o||10);view.scrollTimer=n}}}},scrollToLastPre:function(e){if(!$("#"+e).hasClass("fake-hide")){view.chatScroll&&view.chatScroll.refresh();var t=_$("list_his").scrollHeight,i=$("#content").height(),o=t-i,s=$("#"+e).height();t>i&&view.chatScroll.scrollTo(0,-Math.min(o,s))}},handleLeave:function(e,t){if("leaveDisabled"==e&&($("#chat").remove(),$("#detail").remove(),$("#mask").css({display:"block"}),view.chatScroll=null,view.infoScroll=null,t.sdkOfflineBoxInfo)){$("#leaveDisabled").html('<div class="leave-disabled-tip"><div class="leave-disabled-scroll">'+t.sdkOfflineBoxInfo.disableTips+"</div></div>").show();var i,o=window.innerHeight||document.body.clientHeight;.8*o<$(".leave-disabled-tip").height()+90&&($("#leaveDisabled").css({height:.8*o-90+"px"}),(i=$(".leave-disabled-tip")).css({height:.8*o-90+"px",position:"relative",overflow:"hidden"}),view.leaveDisabledScroll||(view.leaveDisabledScroll=new IScroll(i.results[0],view.chat.iScrollParam)),setTimeout(function(){view.leaveDisabledScroll.refresh()},600))}},handleSatisfy:function(e,t,i){function o(e,i){var o=parseInt(e)-1;if(!t)for(var s=$(".sa-sli").results,n=0;n<5;n++)n<=o?$(s[n]).addClass("sa-star").html("&#xe64d;"):$(s[n]).removeClass("sa-star").html("&#xe6cd;");_$("satisfyConfig").className="sa-sel-"+(o+1),i&&$("#satisfy_ipt").val(o+1)}function s(){var e=parseInt($("#satisfy_ipt").val()||5)-1;if(!t)for(var i=$(".sa-sli").results,o=0;o<5;o++)o<=e?$(i[o]).addClass("sa-star"):$(i[o]).removeClass("sa-star");_$("satisfyConfig").className="sa-sel-"+(e+1),$(".sub-tab-sel").removeClass("sub-tab-sel"),$(".sub-tab"+(e+1)).addClass("sub-tab-sel")}i&&$(".sub-tab"+i).addClass("sub-tab-sel"),$(".sa-stars").on("touchstart touchmove touchend",function(e){var t;if(e.touches&&e.touches.length&&e.clientX)try{t=document.elementFromPoint(e.touches[0].pageX,e.touches[0].pageY)}catch(i){t=document.elementFromPoint(e.clientX,e.clientY)}else;if(t=t||e.target||e.srcElement,$(t).hasClass("sa-sli")){o($(t).attr("v"),!0),view.handleShowSatisfy()}}),$(".sa-stars").on("touchend",s),$(".sa-imgs").on("touchend",s),$(".sa-imgs").on("touchstart touchmove touchend",function(e){var t;if(e.touches&&e.touches.length&&e.clientX)try{t=document.elementFromPoint(e.touches[0].pageX,e.touches[0].pageY)}catch(i){t=document.elementFromPoint(e.clientX,e.clientY)}else;if(t=t||e.target||e.srcElement,$(t).hasClass("sa-un-img")||$(t).hasClass("sa-s-img")){o($(t).attr("v"),!0),view.handleShowSatisfy()}}),$(".sa-cli").on("click",function(e){$(this).hasClass("sub-selected")?$(this).removeClass("sub-selected"):$(this).addClass("sub-selected")}),$("#sa_advise").on("focus",function(e){view.satisfyFocus=!0}).on("blur",function(e){view.satisfyFocus=!1,_$("satisfyContent").style.marginBottom="0"})},toggleLeaveToChat:function(e){1===e?(view.chat.isInWorkOrder?$("#leaveBar").html(lanRes.visitor186):$("#leaveBar").html(lanRes.leaveToChatBtn),$(".list-his-hr",_$("list_msg")).addClass("hide"),$("#leaveBar").show(),$("#toolbar").addClass("height0"),$("#chat_text").addClass("hide")):0===e?($("#list_msg").show(),$("#leaveBar").hide(),$("#toolbar").removeClass("height0"),$("#chat_text").removeClass("hide")):2===e&&($("#toolbar").addClass("height0"),$("#leaveBar").hide(),$("#chat_text").removeClass("recording")),$("#urlList").addClass("hide")},toggleEnded:function(e){"end"==e?$("#chat_text").addClass("enter-show").removeClass("recording"):$("#chat_text").removeClass("enter-show")},initEmotion:function(e){for(var t=['<li class="emo-page hover flex1"><ul class="clearfix box">'],i=['<li class="dot-list-li hover">0</li>'],o=0,s=e.length>63?63:e.length,n=/(^\[#)|(#\]$)/g,a=0;a<s;a++){0!=a&&(a-0)%7==0&&(t.push("</ul>"),(a-0)%21==0?(t.push('</li><li class="emo-page flex1"><ul class="clearfix box">'),i.push('<li class="dot-list-li">'+ ++o+"</li>")):t.push('<ul class="clearfix box">'));var r=e[a].replace(n,"");t.push('<li class="emoji ej-k'+r+'" code="'+r+'"></li>')}t.push("</ul></li></ul>"),_$("emo_list").innerHTML=t.join(""),_$("emo_list").style.width=100*(o+1)+"%",_$("emo_dot_list").innerHTML=i.join("");var l=0;this.pageSlide("#emo_list",function(e){0!=e&&(l+=e,$(".dot-list-li",_$("emo_dot_list")).removeClass("hover"),$($(".dot-list-li",_$("emo_dot_list")).removeClass("hover").results[l]).addClass("hover"))}),view.insertImg=function(e,t){var i=!1;e.selectionStart&&e.selectionEnd?(e.setRangeText(t,e.selectionStart,e.selectionEnd,"end"),e.selectionEnd==_$("textInput").value.length&&(i=!0)):(_$("textInput").value+=t,_$("textInput").innerHTML+=t,i=!0),view.textInputChange(),i&&setTimeout(function(e){_$("textInput").scrollTop=_$("textInput").scrollHeight,_$("textInput").scrollTo(0,_$("textInput").scrollHeight)})}},removeUnreadToLeave:function(){var e=_$("unread");$(".container",_$("leave")).results[0].appendChild(e)},showUnread:function(e){$("#unread_tip").html(lanRes.hasUnreadMsgNum.replace("${num}",e)),$("#unread").show(),setTimeout(function(){var e=_$s("body")[0].clientHeight-101;e-$("#unread_wrap").height()<160?($("#unread_wrap").css("height",e-160+"px"),view.unreadScroll=new IScroll("#unread_wrap",view.chat.iScrollParam)):view.unreadScroll=null},500)},removeUnreadMsg:function(){$("#unread").hide(),$("#list_unread").html(""),$("#unread_tip").html("")},restoreConnet:function(){function e(){view.scrollToBottom(),$(t).off(e)}for(var t,i="",o=0;o<view.imgErrorList.length;o++)i=view.imgErrorList[o].src,view.imgErrorList[o].src="",view.imgErrorList[o].src=i;t=view.imgErrorList[o-1],view.imgErrorList=[],view.scrollToBottom(null,{timeout:500}),t&&$(t).on("load",e)},imgErrorList:[],imgError:function(e,t){view.imgErrorList.push(e),e.getAttribute("identity")},showMsgImg:function(e,t){var i=e.clientFileId||e.fileIdentity;return!!i&&(view.fileMsgs[i]=e,'<div class="msg-media msg-imgs"><img onerror="view.imgError(this)" identity="'+i+'"'+(e.notEnd?"":'onload="javascript:view.scrollToBottom()"')+' id="img'+(e.tm||(new Date).getTime())+'" " src="'+(e.smallImg||e.localFile)+'" class="msg-img "/></div>')},getMsgFile:function(e){_$(e.clientFileId),josn=view.fileMsgs[e.clientFileId]=view.fileMsgs[e.clientFileId]?$.extend(view.fileMsgs[e.clientFileId],e):e;var t,i,o,s;return 3==e.fileType?(t=(i=parseInt((e.voiceDuration||e.duration||0)/1e3)||1)<4?60:15*i,t=Math.min(t,.75*window.innerWidth-40),o='<div class="msg-media msg-voice" identity="'+e.clientFileId+'" style="width:'+t+'px;">'+(3==e.sendStatus?"":'<span class="msg-voice-info">'+i+'"</span>')+"<i></i></div>",3==e.sendStatus&&(o+='<div class="msg-error file-resend" identity="'+e.clientFileId+'"></div>')):4==e.fileType?(s=e.remoteThumbnailPath||e.videoThumbUrl,o='<div class="msg-media msg-video" identity="'+e.clientFileId+'">'+(s?'<img class="msg-video-poster" onerror="view.imgError(this)" src="'+s+'" '+(e.notEnd?"":'onload="javascript:view.scrollToBottom()"')+'alt="这里是视频封面"/>':'<div class="msg-video-poster" ></div>')+'<div class="msg-video-angle"></div></div>'):0!=e.fileType&&2!=e.fileType||(loadMap={0:"未下载",1:"下载完成",2:"下载中",3:"暂停下载"},e.loadStatus=e.loadStatus||0,o='<div class="msg-file file-load-status'+e.loadStatus+'" identity="'+e.clientFileId+'"><div class="file-icon echat"></div><div class="file-info file-info-btn"><div class="file-name">'+e.fileName+'</div><div class="file-size">文件大小（'+((parseInt((e.fileSize||0)/1024)||1)/1024).toFixed(3)+'M）</div></div><div class="file-load-bar clearfix"><div class="file-load-bar-info">'+(e.loadStatus&&0!=e.loadStatus&&3!=e.loadStatus?"":"点击下载")+(1==e.loadStatus?"点击打开":"")+(2==e.loadStatus?e.progress||"0%":"")+(4==e.loadStatus?'<span class="red">下载失败</span>重新下载':"")+'</div><div class="file-load-progress"><div class="file-load-progress0" style="width:'+(e.progress||0)+'%"></div></div></div></div>'),o},getMsgSendingFile:function(e){if(e.fileIdentity||(e.fileIdentity=e.clientFileId),3!=e.fileType||!_$(e.clientFileId)){var t;return 3==(e=view.fileMsgs[e.clientFileId]=view.fileMsgs[e.clientFileId]?$.extend(view.fileMsgs[e.clientFileId],e):e).fileType?(e.mt=866,view.chat.publish("getMsgFile",e),null):(1!=e.fileType&&4!=e.fileType||(t='<div class="msg-media '+(1==e.fileType?"msg-imgs":"msg-video")+(3==e.sendStatus?" msg-media-error":"")+'" identity="'+e.clientFileId+'"><img onerror="view.imgError(this)" identity="'+e.clientFileId+'" class="'+(4==e.fileType?"msg-video-poster":"msg-img")+'" src="'+(1==e.fileType?e.localFile:e.localThumbnailPath)+'" /><div class="msg-preview-info"><div class="msg-preview-progress">'+(e.sendStatus&&0!=e.sendStatus&&1!=e.sendStatus?2==e.sendStatus?"100%":3==e.sendStatus?"":4==e.sendStatus?"收到866/865":"发送状态未知":(e.progress||0)+"%")+"</div></div>",4==e.fileType&&(t+='<div class="msg-video-angle"></div>')),t+="</div>",3==e.sendStatus&&(t+='<div class="msg-error file-resend" identity="'+e.clientFileId+'"></div>'),t)}},handleHis:function(e){var t,i=view.chat,o=e.config;if(o)for(var s=0;s<o.length;s++)if(604==(t=o[s]).mt)e.staffName||(e.staffName=t.staffNickName||lanRes.serviceStaff,e.staffImg=t.staffDetailInfo&&t.staffDetailInfo.staffHead||e.staffImg),t.staffDetailInfoMsgList?i.handleStaffMap(t.staffDetailInfoMsgList,!0):view.chat.staffMap[t.staffId]||(i.staffMap[t.staffId]={staffId:t.staffId,staffName:t.staffNickName||lanRes.serviceStaff,staffImg:t.staffDetailInfo&&t.staffDetailInfo.staffHead});else if(649==t.mt){var n=t.robotSdkChatBox||t.sdkChatBoxInfo;n.sdkUrlList=null,t.notStore=!0,view.setConfig(view.chat,t,n),t.robotSdkChatBox?(e.robotStaffImg=t.robotConfigInfo.hasRobotDefImg?t.robotSdkChatBox.defaultStaffImg:t.robotConfigInfo.robotImg,e.robotStaffName=t.robotExtInfo.nickName):t.sdkChatBoxInfo&&(e.staffImg=n.defaultStaffImg),t.sdkEntranceInfo=null,t.captChaToken=null}else 600==t.mt&&(t.routeEntranceInfo=null,t.routeEntranceInfoString=null)},loadEmoji:function(){var e=view.chat;e.emo=window.emojiJson,e.emoLan=window.emojiLanJson;var t={};for(var i in e.emoLan)t[e.emoLan[i]]=i;e.lanEmo=t;var o=window.emojiFaceJson;view.initEmotion.call(e,o),$("#emotion").on("tap",".emoji",function(t){e.insertImg($(this).attr("code")),view.textInputChange(),view.chat.handleInputLength&&view.chat.handleInputLength()})},handleRouterSelect:function(e,t){var i=window.innerHeight||document.body.clientHeight,o=$("#routerList").height(),s=$("#routerTitle").height();if(.8*i<o+s){$("#router").css({height:.8*i+"px"}),$("#routerList").css({height:.8*i-s+"px",position:"relative"});var n=new IScroll("#routerList",view.chat.iScrollParam);setTimeout(function(){n.refresh()},600)}else $("#routerList").css({height:"auto"})},blurInfoInput:function(){window.scrollTo(0,0)},handleEntryInputFocus:function(){function e(){t.value=_$("entryFocusInput").value,view.chat.checkIpt(t,t.value.replace(/^[\s]+|[\s]+$/gi,""),t.name,function(e){}),_$("entryFocusInput").value="",$("body").removeClass("entry-focus"),_$("entryFocusInput").removeEventListener("blur",e),t=null}var t,i,o;return function(s){"date"!=(t=s.target).type&&(i&&(clearTimeout(i),i=null),$("#entryFocus").css({top:view.winH-60+"px"}),$("body").addClass("entry-focus"),$("#entryFocusLabel").html(t.getAttribute("lb")||t.lb||""),(o=_$("entryFocusInput")).name=t.name,o.type=t.type,o.value=t.value,o.focus(),o=null,i=setTimeout(function(){i=null,height=view.lastKeyboardHeight;var e=_$("entryFocus").getBoundingClientRect().bottom;if(window.innerHeight==e)return console.log(view.winH,height,window.innerHeight,"**innerHeight change",e),void window.scrollTo(0,view.winH);var t=parseInt(window.getComputedStyle(_$("entryFocus")).getPropertyValue("margin-bottom"))||0,o=height-view.winH+e+t;(o<3&&o>-3||window.innerHeight==e)&&(o=0),console.log(view.winH,e,height,t,"**500ms**",window.innerHeight,o),_$("entryFocus").style.marginBottom=o+"px"},600),_$("entryFocusInput").addEventListener("blur",e))}}(),hideSatisfy:function(){$("#footer").removeClass("hide-satisfy"),view.resetContainerBaseFoot()},handleShowSatisfy:function(){function e(){i=0,t=null,view.hideMenus(),view.inputBlur(),$("#footer").addClass("hide-satisfy"),view.resetContainerBaseFoot();var e,o=window.innerHeight||document.body.clientHeight,s=$("#satisfyContent").height()+85;view.winH-o>100||(.8*o<s?($("#satisfy").css({height:.8*o+"px"}),(e=$(".sub-tabs",_$("satisfy"))).css({height:.8*o-(185+$(".sa-title",_$("satisfy")).height()+49+10)+"px",position:"relative",overflow:"hidden"}),view.satisfyScroll||(view.satisfyScroll=new IScroll(e.results[0],view.chat.iScrollParam)),setTimeout(function(){view.satisfyScroll.refresh()},600)):($(".sub-tabs",_$("satisfy")).css({height:"auto"}),$("#satisfy").css({height:"auto"}),view.satisfyScroll&&(view.satisfyScroll.scrollTo(0,0),view.satisfyScroll.destroy())))}var t=null,i=1;return function(){i?(i=0,e()):t||(t=setTimeout(e,500))}}(),handleShowRobotToStaff:function(){$("#footer").css("bottom","0px"),view.resetContainerBaseFoot(),view.chatScroll&&view.chatScroll.refresh()}}}();